Post Hartree-Fock
#################

Quantum chemistry is mature enough to have a canonical approaches followed by
Hartree-Fock method. Their behaviour, successes, and most importantly their
failures are widely known and accepted. With a couple of exceptions which we
will not mention, they are known as:

- Configuration Interaction(CI)
- Coupled-Cluster(CC)
- Perturbation Theory(PT)

Configuration Interaction
=========================
The configuration interaction method is a commonly used quantum chemistry method, which is used to correct 
electron correlation based on the Hartreeâ€“-Fock method. This method writes the wave function as linear 
combination of configuration state functions.

.. math::

	|\Psi_{CI}\rangle = \sum_{\lbrace i \rbrace}c_i|i\rangle

the coefficients :math:`c_i` for the configuration state function can be determined by variational principle 

.. math::

	\frac{\langle\Psi_{CI}|H|\Psi_{CI}\rangle}{\langle\Psi_{CI}|\Psi_{CI}\rangle}\geq E_0

approach the ground state energy by minimizing

.. math::

	min_{|\Psi_{CI}\rangle}(\langle\Psi_{CI}|H|\Psi_{CI}\rangle-\lambda\langle\Psi_{CI}|\Psi_{CI}\rangle)

which equivalent to a set of eigenvalue equation

.. math::

	E_{CI} = min_{\Psi_{CI}} 
	\frac{\langle \Psi_{CI}|\hat{H}|\Psi_{CI}\rangle}{\langle\Psi_{CI} | \Psi_{CI} \rangle}
	HC = E_{CI} C

where H is the Hamiltonian Matrix with elements

.. math::

	H_{ij} = \langle i|\hat{H}|j\rangle

Without constraints, the configuration interaction wave function contains all Slater determinants generated by 
distributing n electrons among m spin orbitals, which is called Full CI method. It gives an exact result in a 
given limited AO basis. Unfortunately, the number of Slater determinants included in full CI method increases 
very steeply. 

.. math::

	N_{det} = \binom{m}{n}

therefore full CI method is not applicable in large systems, usually used for benchmarking of minimal 
system in development of new methods.

In practices, we truncated the CI space by excitation order to save computational time. CI with singly and 
doubly excited determinants methods(CISD) are implemented in many standard packages.

.. math::

	|\Psi_{TCI}\rangle = c_0 | \Phi_0\rangle 
	+ \mathop{\sum_{\lbrace i \rbrace}}_{\lbrace a \rbrace} c_i^a|\Phi_i^a\rangle
	+ \mathop{\sum_{\lbrace i,j \rbrace}}_{\lbrace a,b \rbrace} c_{ij}^{ab}|\Phi_{ij}^{ab}\rangle 
	+ \dots						

However, since in the truncated CI higher excitations are forbidden, hence the model is not size-extensive.
Also in large systems, high--order disconnected excitations dominate. Truncated CI therefore works best for
small systems, and important for small multi--configurational systems.

CISD
----
.. math::

	|\Psi_{TCI}\rangle = c_0 | \Phi_0\rangle 
	+ \mathop{\sum_{\lbrace i \rbrace}}_{\lbrace a \rbrace} c_i^a|\Phi_i^a\rangle
	+ \mathop{\sum_{\lbrace i,j \rbrace}}_{\lbrace a,b \rbrace} c_{ij}^{ab}|\Phi_{ij}^{ab}\rangle 

Configuration interaction singles and doubles
    .. literalinclude:: ../data/examples/ci/cisd.py
            :lines: 1-20
            :caption: /data/examples/ci/cisd.py

Full CI
-------
.. math::

	|\Psi_{TCI}\rangle = c_0 | \Phi_0\rangle 
	+ \mathop{\sum_{\lbrace i \rbrace}}_{\lbrace a \rbrace} c_i^a|\Phi_i^a\rangle
	+ \mathop{\sum_{\lbrace i,j \rbrace}}_{\lbrace a,b \rbrace} c_{ij}^{ab}|\Phi_{ij}^{ab}\rangle 
	+ \dots						

Full configuration interaction
    .. literalinclude:: ../data/examples/ci/fci.py
            :lines: 1-20
            :caption: /data/examples/ci/fci.py

Coupled-Cluster
===============
Coupled cluster methods are among the most accurate electronic structure methods 
available today. Its wave--function ansatz is usually written in exponential form:


the cluster operator :math:`\hat{T}` is defined as sum of :math:`\hat{T}_{i}` generate all possible determinants having i excitations from the reference.

.. math::

	\hat{T} = \sum_{1}^{N} \hat{T}_{i} 

the first few component of cluster operator are

.. math::

	\hat{T}_1 = \mathop{\sum_{i\in occ}}_{\alpha \in virt} t_i^{\alpha} a_{\alpha}^{\dagger} a_{i}
	\hat{T}_2 = \frac{1}{(2!)^2}\mathop{\sum_{ij\in occ}}_{\alpha \beta \in virt} 
	t_{ij}^{\alpha\beta}
	a_{\alpha}^{\dagger} a_{\beta}^{\dagger} a_{j}a_{i}

apply a similarity-transformation, multiplying the CC Schr\"{o}dinger equation in the form

.. math::

	\hat{H} e^{\hat{T}} |{\Phi_{0}} \rangle 
	&= E e^{\hat{T}} |{\Phi_{0}} \rangle \\
	e^{\hat{-T}}\hat{H} e^{\hat{T}} |{\Phi_{0}} \rangle 
	&= e^{\hat{-T}}E e^{\hat{T}} |{\Phi_{0}} \rangle \\
	e^{\hat{-T}}\hat{H} e^{\hat{T}} |{\Phi_{0}} \rangle 
	&= E |{\Phi_{0}} \rangle \\	

the amplitudes should be optimized to determine the CC wave--function. Unlike Hartree--Fock or CI wave--function 
is optimized by variational principle, CC wave--function is optimized by projecting. 

.. math::

	\langle \Phi_0 | \hat{H} e^{\hat{T}} |{\Phi_{0}} \rangle &= E  \\
	\langle \Phi_{ij\dots}^{ab\dots}|e^{\hat{-T}}\hat{H} e^{\hat{T}} |{\Psi_{0}} \rangle &= 0 \\

by solving the nonlinear equations, the CC energy and amplitudes are determined.

The CC hierarchy represents the most successful wave--function quantum chemistry. 
It is reasonable to assume that lower-order excitations are more important than higher-order ones. 
The CCSD wave function contains contributions from all FullCI determinants, generated by connected and 
disconnected excitations, hence CCSD method is also size--extensive. CCSD and its triples correction CCSD(T) 
methods are the gold standard of quantum chemistry for its high accuracy and reliability. 

Although CC are among the most successful quantum chemistry methods, generalizing CC ansatz to 
multi--configurational reference states is difficult. Therefore CC method is hard for system with 
strong correlation. 


CCSD
----
To implement the  CCSD method, we should follow the procedure:

* Preparing the Spin-Orbital Basis Integrals
* Build the Initial-Guess Cluster Amplitudes
For Hartree-Fock reference determinants, the most common initial guess for the
cluster amplitudes are the Moller-Plesset first-order perturbed wave function:

.. math::
    t_i^a = 0
.. math::
    t_{ij}^{ab} = \frac{\langle ij || ab \rangle}{\epsilon_i + \epsilon_j -
    \epsilon_a - \epsilon_b}

* Calculate the CC Intermediates
Use the spin-orbital Eqs. 3-13 from Stanton's paper to build the two-index (F)
and four-index (W) intermediates, as well as the effective doubles (labelled
with the Greek letter tau). 

* Compute the Updated Cluster Amplitudes
Use Eqs. 1 and 2 from Stanton's paper to compute the updated T1 and T2 cluster amplitudes.

* Check for Convergence and Iterate Calculate the current CC correlation energy:

.. math::
    E_{\rm CC} = \sum_{ia} f_{ia} t_i^a + \frac{1}{4} \sum_{ijab} \langle
    ij||ab\rangle t_{ij}^{ab} + \frac{1}{2} \sum_{ijab} \langle ij||ab\rangle t_i^a
    t_j^b

Compare energies and cluster amplitudes between
iterations to check for convergence to some specified cutoff. If convergence is
reached, you're done; if not, return to third step and continue.

To run a CCSD calculation in MoHa, the example is below:

.. literalinclude:: ../data/examples/cc/ccsd.py
        :lines: 1-20
        :caption: /data/examples/cc/ccsd.py

CCSD(T)
-------
To find the perturbative triples correction, the disconnected and connected T3 have to be calculated.
The disconnected is found as:

Perturbative Triples Correction
    .. literalinclude:: ../data/examples/cc/ccsd_t.py
            :lines: 1-20
            :caption: /data/examples/cc/ccsd_t.py

Perturbation Theory
===================
For perturbation theory, we divide the Hamiltonian into zero--order operator :math:`\hat{H}_0 and perturbaing 
operator :math:`\lambda\hat{V}`. Specifically in M{\o}ller--Plesset theory, we use the Fock operator as 
the zero--order operator and the Hartree--Fock state as the zero--order state:

.. math::

	\hat{H}_0 = \hat{F}; 
	\quad \hat{V} = \hat{H} - \hat{F} 

the unperturbed Schr\"{o}dinger equation:

.. math::

	\quad \hat{F}|\Psi_{HF}\rangle = \sum_{i}\varepsilon_i |\Psi_{HF}\rangle; 

the time-independent related Schr\"{o}dinger equation:

.. math::

	(\hat{F} + \lambda \hat{V})|\Psi_n \rangle = E_n |\Psi_n \rangle

we apply Taylor series to expands the energies and states in eqn \ref{eq:mp3} of the parameter $\lambda$

.. math::

	E_n = E_n^{(0)} + \lambda E_n^{(1)} + \lambda^2 E_n^{(2)} + \dots

and

.. math::

	|\Psi_{n}\rangle = |\Psi_{n}^{(0)} \rangle 
	+ \lambda |\Psi_{n}^{(0)} \rangle + \lambda^2 |\Psi_{n}^{(2)} \rangle + \dots

the :math:`E_n^{(k)}` and :math:`\Psi_n^{(k)}` are the corresponding derivatives

.. math::

    E_n^{(k)} = \frac{1}{k!} \frac{\partial^k E_n}{\partial \lambda^k}

.. math::

	\Psi_n^{(k)} = \frac{1}{k!} \frac{\partial^k \Psi_n}{\partial \lambda^k}

substitute of these expand series into the time-independent Schr\"{o}dinger equation

.. math::

		(\hat{F} + \lambda \hat{V})
		|\Psi_n^{(0)} + \lambda |\Psi_n^{(1)} + \lambda^2 |\Psi_n^{(2)} + \dots\rangle
	&= \\
	(E_n^{(0)} + \lambda E_n^{(1)} + \lambda^2 E_n^{(2)} +\dots) 
		|\Psi_n^{(0)} + \lambda |\Psi_n^{(1)} + \lambda^2 |\Psi_n^{(2)} + \dots\rangle	&

we expand both side of the equation, put the terms involving equate powers of :math:`\lambda` and generate a set
of equations. 

.. math::

		\hat{F}|\Psi_n^{(0)}\rangle 
		&= E_n^{(0)}|\Psi_n^{(0)}\rangle \\
		\hat{F}|\Psi_n^{1}\rangle +\hat{V}|\Psi_n^{(0)}\rangle	
		&= E_n^{(0)}|\Psi_n^{(1)}\rangle + E_n^{(1)}|\Psi_n^{(0)}\rangle\\
		\hat{F}|\Psi_n^{2}\rangle +\hat{V}|\Psi_n^{(1)}\rangle 	
		&= E_n^{(0)}|\Psi_n^{(2)}\rangle + E_n^{(1)}|\Psi_n^{(1)}\rangle	 + E_n^{(2)}|\Psi_n^{(0)}\rangle\\
		&\dots				
as the solution of zeroth--order equation is known, one expects, M{\o}ller--Plesset theory approaches are 
performed on top of previous result. Therefore we can determine the various nth--order corrections.

Given a reasonably accurate Hartree--Fock reference, we may improve on it by M{\o}ller--Plesset perturbation
theory. As a non-iterative way to calculate electron correlation energy, The MP2 energy represents a highly 
successful approximation at a fraction of the cost compare with other post--Hartree--Fock methods. 

Unfortunately in a sufficiently large system, the M{\o}ller--Plesset method often diverges. Higher-order 
corrections may be calculated, but convergence is often poor. 


MP2
---
Moller-Plesset Second Order Perturbation theory (MP2) is a non-iterative
way to calculate electron correlation energy The expression for it's energy
contribution can be written as:

.. math::

    E_{\rm MP2} = \sum_{ij} \sum_{ab} \frac{(ia|jb) \left[ 2 (ia|jb) -
    (ib|ja) \right]}{\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_b}

where the two electron integral are molecular integral and should be transform
from atomic orbtial to molecular orbital basis.

.. math::
    (pq|rs) = \sum_\mu C_\mu^p \left[ \sum_\nu C_\nu^q \left[ \sum_\lambda
    C_\lambda^r \left[ \sum_\sigma C_\sigma^s (\mu \nu|\lambda \sigma) \right]
    \right] \right]

To run a MP2 calculation in MoHa, the example is below:

.. literalinclude:: ../data/examples/pt/mp2.py
        :lines: 1-20
        :caption: /data/examples/pt/mp2.py

MP3
---
Configuration Interaction Double
    .. literalinclude:: ../data/examples/pt/mp3.py
            :lines: 1-20
            :caption: /data/examples/pt/mp3.py
