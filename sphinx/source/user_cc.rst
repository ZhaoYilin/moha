===============
Coupled-Cluster
===============
Coupled cluster methods are among the most accurate electronic structure methods available today. Its wave function ansatz is usually written in exponential form:

.. math:: \vert\Psi\rangle = e^{\hat{T}} \vert\Phi_0\rangle

Where the cluster operator :math:`\hat{T}` is defined as the sum of :math:`\hat{T}_{i}` generates all possible determinants having the i-th excitations from the reference.

.. math:: \hat{T} = \sum_{i=1}^{N} \hat{T}_{i}

the first few component of cluster operator are

.. math::

    \hat{T}_1 &= \mathop{\sum_{i\in occ}}_{\alpha \in virt} t_i^{\alpha} a_{\alpha}^{\dagger} a_{i}\\
    \hat{T}_2 &= \frac{1}{(2!)^2}\mathop{\sum_{ij\in occ}}_{\alpha \beta \in virt} 
    t_{ij}^{\alpha\beta}a_{\alpha}^{\dagger} a_{\beta}^{\dagger} a_{j}a_{i}

apply a similarity-transformation, multiplying the CC Schr√∂dinger equation in the form

.. math::

    \hat{H} e^{\hat{T}} \vert\Phi_{0} \rangle &= E e^{\hat{T}} \vert\Phi_{0} \rangle \\
    e^{\hat{-T}}\hat{H} e^{\hat{T}} \vert\Phi_{0} \rangle &= e^{\hat{-T}}E e^{\hat{T}} \vert\Phi_{0} \rangle \\
    e^{\hat{-T}}\hat{H} e^{\hat{T}} \vert\Phi_{0} \rangle &= E \vert\Phi_{0} \rangle \\

the amplitudes should be optimized to determine the CC wave function. Unlike Hartree--Fock or CI wave function is optimized by variational principle, CC wave function is optimized by projecting. 

.. math::

    \langle \Phi_0 \vert\hat{H} e^{\hat{T}} \vert\Phi_{0} \rangle &= E\\
    \langle \Phi_{ij\dots}^{ab\dots}\vert e^{\hat{-T}}\hat{H} e^{\hat{T}} \vert\Psi_{0} \rangle &= 0 \\

by solving the nonlinear equations, the CC energy and amplitudes are determined.

The CC hierarchy represents the most successful wave--function quantum chemistry. It is reasonable to assume that lower-order excitations are more important than higher-order ones. The CCSD wave function contains contributions from all FullCI determinants, generated by connected and disconnected excitations, hence CCSD method is also size--extensive. CCSD and its triples correction CCSD(T) methods are the gold standard of quantum chemistry for its high accuracy and reliability. 

Although CC are among the most successful quantum chemistry methods, generalizing CC ansatz to multi--configurational reference states is difficult. Therefore CC method is hard for system with strong correlation. 


CCSD
----
To implement the  CCSD method, we should follow the procedure:

* Preparing the Spin-Orbital Basis Integrals
* Build the Initial-Guess Cluster Amplitudes

For Hartree-Fock reference determinants, the most common initial guess for the cluster amplitudes are the Moller-Plesset first-order perturbed wave function:

.. math::
    t_i^a = 0

.. math::
    t_{ij}^{ab} = \frac{\langle ij \vert\vert ab \rangle}{\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_b}

* Calculate the CC Intermediates

Use the spin-orbital Eqs. 3-13 from Stanton's paper to build the two-index (F)
and four-index (W) intermediates, as well as the effective doubles (labelled
with the Greek letter tau). 

* Compute the Updated Cluster Amplitudes

Use Eqs. 1 and 2 from Stanton's paper to compute the updated T1 and T2 cluster amplitudes.

* Check for Convergence and Iterate Calculate the current CC correlation energy:

.. math::
    E_{\rm CC} = \sum_{ia} f_{ia} t_i^a + \frac{1}{4} \sum_{ijab} \langle
    ij||ab\rangle t_{ij}^{ab} + \frac{1}{2} \sum_{ijab} \langle ij||ab\rangle t_i^a
    t_j^b

Compare energies and cluster amplitudes between iterations to check for convergence to some specified cutoff. If convergence is reached, you're done; if not, return to third step and continue.

To run a CCSD calculation in MoHa, the example is below:

CCSD(T)
-------
To find the perturbative triples correction, the disconnected and connected T3 have to be calculated. The disconnected is found as:

.. math::

    D^{abc}_{ijk}t^{abc}_{ijk,disconnected}=P(i/jk)P(a/bc)t^{a}_{i}\langle jk \vert\vert bc\rangle

And the connected is found as:

.. math::

    D_{ijk}^{abc}t_{ijk,\mathrm{connected}}^{abc}=P\left(i/jk\right)P\left(a/bc\right)\left[\sum_{e}^{virt}t_{jk}^{ae}\left\langle ei\left|\right|bc\right\rangle -\sum_{m}^{occ}t_{im}^{bc}\left\langle ma\left|\right|jk\right\rangle \right]

In the above equations the following definitions is used:

.. math::

    D_{ijk}^{abc}=f_{ii}+f_{jj}+f_{kk}-f_{aa}-f_{bb}-f_{cc}

.. math::

    P\left(i/jk\right)f\left(i,j,k\right)=f\left(i,j,k\right)-f\left(j,i,k\right)-f\left(k,j,i\right)

The energy correction can now be found as:

.. math::

    E_{\mathrm{\left(T\right)}}=\frac{1}{36}\sum_{i,j,k,a,b,c}^{occ,occ,occ,virt,virt,virt}t_{ijk,\mathrm{connected}}^{abc}D_{ijk}^{abc}\left(t_{ijk,\mathrm{connected}}^{abc}+t_{ijk,\mathrm{disconnected}}^{abc}\right)

Examples
--------   
* CCSD

Truncating the cluster operator :math:`\hat{T}` at doubles leads to the coupled cluster singles and doubles method(CCSD). By keep only :math:`\hat{T}_1` and :math:`\hat{T}_2`, we reach the balance between accuracy and computational time.

.. literalinclude:: ../../data/examples/cc/ccsd.py
    :caption: /data/examples/cc/ccsd.py

* CCSD(T)

Based on CCSD, the addition of perturbative triple correction gives CCSD(T) method the reputation of being the "gold standard" in computational chemistry. It is now one of the most accurate methods applicable to reasonably large molecules.   

.. literalinclude:: ../../data/examples/cc/ccsd_t.py
    :caption: /data/examples/cc/ccsd_t.py
