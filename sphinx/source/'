=========================
Configuration Interaction
=========================
Configuration interaction approximates wave function by a linear expansion of N--electron basis functions with a given one--electron basis. 

.. math::

    \vert \Psi_{CI}\rangle = \sum_{\lbrace i \rbrace}c_i \vert \Phi_i\rangle

where :math:`\Phi_i` is the i--th configuration, and :math:`c_i` is the corresponding coefficient. 
With CI wave function ansatz and CI basis set, the Schrödinger equation becomes a matrix-eigenvalue equation.

.. math::

    \mathbf{H}\mathbf{C} = E \mathbf{C}

CI algorithm
------------
  

* **Step 1: Build The Integral**

The pre--computed quantities for the SCF algorithm include:

    * The nuclear repulsion energy :math:`E_{nuc}`.

    * One--electron integrals overlap :math:`\mathbf{S}`, kinetic energy :math:`\mathbf{T}`, and nuclear attraction :math:`\mathbf{V}`.

    * Two--electron integral, the electron repulsion :math:`(\mu\nu\vert\lambda\sigma)`.

Please check out the :ref:`Hamiltonian <Hamiltonian>` section for further information to learn more about the pre--computed quantities.

* **Step 2: Optimized the molecular orbital coefficients by SCF Calculation**

The Hartree-Fock method is an uncorrelated mean-field theory that offers a qualitative description of chemical systems. Although Hartree-Fock theory is only qualitatively correct, it forms the basis for more accurate models and becomes the cornerstone of ab initio quantum chemistry.

Please check out the :doc:`user_hf` section for further information.

* **Step 3: Transformation of atomic orbital to molecular orbital**

With the optimized LCAO_MO coefficients, we can transform the operators from the atomic orbital basis to the molecular orbital basis.

For the one electron operators:

.. math::

    h_{ij} = \sum_{\mu\nu}C_{\mu}^jC_{\nu}^i \langle\phi_{\mu}\vert\hat{h}\vert\phi_{\nu}\rangle
    = \sum_{\mu\nu} C_{\mu}^j C_{\nu}^i F_{\mu\nu}

For the two electron operators:

.. math::

    \langle pq \vert rs\rangle = \sum_{\mu} C_{\mu}^p \left[
    \sum_{\nu} C_{\nu}^q \left[
    \sum_{\lambda} C_{\lambda}^r \left[
    \sum_{\sigma} C_{\sigma}^s 
    \langle\mu\nu\vert\lambda\sigma\rangle\right]\right]\right]


* **Step 4: Construction of N--electron basis set**

Configuration interaction method need a N--electron basis set :math:`\{\Phi_i\}`, here specifically denotes a set of orthonormal Slater determinants made of a set of molecular spin orbitals :math:`\{\chi(\mathbf{x}_i)\}`.

.. math::

    \langle \Phi_i \vert \Phi_j \rangle = \delta_{ij} 

Without constraints, the configuration interaction wave function contains all Slater determinants generated by distributing n electrons among m spin orbitals, called the Full CI method. It gives an exact result on a given limited AO basis. Unfortunately, the number of Slater determinants included in the Full CI method increases steeply.       
 
.. math::

    N_{det} = \binom{m}{n}

* **Step 5: Calculation and storage of the Hamiltonian matrix elements**

To optimize the configuration interaction wave function and minimize the energy,  with the normalized constrain :math:`\langle \Psi \vert \Psi \rangle = 1`. By varying the coefficients :math:`c_i` with the variational principle,

.. math::

    \mathop{min}\limits_{\{c_i\}}(\langle\Psi_{CI}\vert H \vert \Psi_{CI}\rangle-E\langle\Psi_{CI}\vert\Psi_{CI}\rangle)

The optimaztion using variational principle results in the Schrödinger equation becomes a matrix--eigenvalue equation:

.. math::

    \mathbf{H}\mathbf{C} = E \mathbf{C}

:math:`\mathbf{H}` is the Hamiltonian operator :math:`\hat{H}` in matrix form, with the Slater--condon rules, we can express its elements :math:`H_{ij} = \langle \Phi_i\vert\hat{H}\vert \Phi_j\rangle` in terms of electron integrals.


Identical Determinants:

.. math::

   \langle\Phi_i \vert\hat{H}\vert \Phi_i\rangle = 
   \sum_m^N \langle m \vert\hat{h}\vert m \rangle +
   \sum_{m>n}^N \langle mn \vert\vert mn \rangle

Determinants that Differ by One Spin Orbitals:

.. math::

   \vert \Phi_i \rangle &= \vert \dots mn \dots \rangle\\ 
   \vert \Phi_j \rangle &= \vert \dots pn \dots \rangle\\ 
   \langle\Phi_i \vert\hat{H}\vert \Phi_j\rangle &= 
   \langle m \vert\hat{h}\vert p \rangle +
   \sum_{n}^N \langle mn \vert\vert pn \rangle

Determinants that Differ by Two Spin Orbitals:

.. math::

   \vert \Phi_i \rangle &= \vert \dots mn \dots \rangle\\ 
   \vert \Phi_j \rangle &= \vert \dots pq \dots \rangle\\ 
   \langle\Phi_i \vert\hat{H}\vert \Phi_j\rangle &= 
   \langle mn \vert\vert pq \rangle

Determinants that Differ by More than Two Spin Orbitals:

.. math::

   \vert \Phi_i \rangle &= \vert \dots mno \dots \rangle\\ 
   \vert \Phi_j \rangle &= \vert \dots pqr \dots \rangle\\ 
   \langle\Phi_i \vert\hat{H}\vert \Phi_j\rangle &= 0

* **Step 6: Solution of the Matrix eigenvalue problem for the desired state**

Once the, the only numerical problem in their solution is the calculation of the eigenvalues and eigenvectors of a mymmetric matrix. This is a problem which occurs in many branches of science, particularly those involving optimisation of some kind and has ,consequently, received much attention.


Full CI
------- 
The full configuration interaction(FCI) method assumes that all electrons are correlated among all orbitals in a given system. Hence it provides numerically exact solutions (within the infinitely flexible complete basis set) to the electronic time-independent, non-relativistic Schrödinger equation. Therefore, the Full CI method is not applicable in large systems, usually used for benchmarking minimal systems to develop new methods.       
 
.. math::

    \vert\Psi_{FCI}\rangle = c_0 \vert\Phi_0\rangle 
    + \mathop{\sum_{\lbrace i \rbrace}}_{\lbrace a \rbrace} c_i^a\vert\Phi_i^a\rangle
    + \mathop{\sum_{\lbrace i,j \rbrace}}_{\lbrace a,b \rbrace} c_{ij}^{ab}\vert\Phi_{ij}^{ab}\rangle 
    + \dots				

.. literalinclude:: ../../data/examples/ci/fci.py
    :caption: /data/examples/ci/fci.py

CISD
----
FCI method is exact in a given atomic orbital basis but prohibitively expensive. Therefore, to balance accuracy and computational time, we truncate the CI space by excitation level relative to the reference state. The most common truncation of the CI space expansion is CI singles and doubles (CISD).

However, since in the truncated CI, higher excitations are forbidden, hence the model is not size-extensive. Also, in large systems, high–order disconnected excitations dominate. Truncated CI, therefore, works best for small systems and is important for small multi–configurational systems.    

.. math::

    \vert\Psi_{CISD}\rangle = c_0 \vert\Phi_0\rangle 
    + \mathop{\sum_{\lbrace i \rbrace}}_{\lbrace a \rbrace} c_i^a\vert\Phi_i^a\rangle
    + \mathop{\sum_{\lbrace i,j \rbrace}}_{\lbrace a,b \rbrace} c_{ij}^{ab}\vert\Phi_{ij}^{ab}\rangle 

.. literalinclude:: ../../data/examples/ci/cisd.py
    :caption: /data/examples/ci/cisd.py

